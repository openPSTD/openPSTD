//////////////////////////////////////////////////////////////////////////
// This file is part of openPSTD.                                       //
//                                                                      //
// openPSTD is free software: you can redistribute it and/or modify     //
// it under the terms of the GNU General Public License as published by //
// the Free Software Foundation, either version 3 of the License, or    //
// (at your option) any later version.                                  //
//                                                                      //
// openPSTD is distributed in the hope that it will be useful,          //
// but WITHOUT ANY WARRANTY; without even the implied warranty of       //
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        //
// GNU General Public License for more details.                         //
//                                                                      //
// You should have received a copy of the GNU General Public License    //
// along with openPSTD.  If not, see <http://www.gnu.org/licenses/>.    //
//                                                                      //
//////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////
//
// Date: 7-11-2016
//
//
// Authors: M. R. Fortuin
//
//
// Purpose:
//
//
//////////////////////////////////////////////////////////////////////////

#include "Macros.h"

#include <boost/test/unit_test.hpp>
#include <kernel/DG/Coordinates.h>
#include <iostream>

using namespace OpenPSTD::Kernel::DG;
using namespace std;
using namespace Eigen;

BOOST_AUTO_TEST_SUITE(DG)
    BOOST_AUTO_TEST_SUITE(Coordinates_tests)
        BOOST_AUTO_TEST_CASE(Coordinates_RSToAB)
        {
            ArrayXX<double> rs(2, 66);
            ArrayXX<double> expectedAB(2, 66);
            rs <<
                            -1,-0.9340014304080595,-0.7844834736631443,-0.56523532699620493,-0.29575813558693947,2.7755575615628914e-16,0.2957581355869392,0.56523532699620493,0.7844834736631443,0.93400143040805916,1,-1,-0.9083268446228564,-0.73094144337958422,-0.48806130091019889,-0.20412896393866903,0.09399300507126776,0.37929942281043361,0.62698457983947686,0.81665368924571158,0.93400143040805916,-1.0000000000000004,-0.89604313645989253,-0.7026627492340527,-0.44650772492108581,-0.1569348071111891,0.13625895639891111,0.40532549846810484,0.62698457983947642,0.7844834736631443,-0.99999999999999989,-0.89123812190023499,-0.68975123147782558,-0.4287426028345741,-0.14251479433085174,0.13625895639891111,0.37929942281043411,0.56523532699620482,-1,-0.88986404113259865,-0.68613038577762131,-0.4287426028345741,-0.1569348071111894,0.093993005071267621,0.29575813558693947,-1,-0.88986404113259876,-0.68975123147782536,-0.44650772492108554,-0.20412896393866925,-2.7755575615628914e-16,-1,-0.89123812190023532,-0.70266274923405225,-0.48806130091019839,-0.2957581355869392,-1,-0.8960431364598922,-0.73094144337958467,-0.56523532699620505,-0.99999999999999989,-0.9083268446228554,-0.78448347366314419,-1,-0.93400143040805927,-1,
                            -1,-1,-1,-1,-1,-1,-1,-1,-1,-0.99999999999999989,-1,-0.93400143040805939,-0.90832684462285529,-0.8960431364598922,-0.89123812190023532,-0.88986404113259854,-0.88986404113259854,-0.89123812190023521,-0.8960431364598922,-0.90832684462285618,-0.93400143040805939,-0.78448347366314441,-0.73094144337958478,-0.70266274923405247,-0.68975123147782536,-0.68613038577762142,-0.68975123147782558,-0.70266274923405236,-0.73094144337958422,-0.7844834736631443,-0.56523532699620505,-0.48806130091019845,-0.44650772492108542,-0.42874260283457399,-0.42874260283457416,-0.44650772492108576,-0.48806130091019867,-0.56523532699620505,-0.2957581355869392,-0.20412896393866919,-0.15693480711118951,-0.14251479433085162,-0.15693480711118896,-0.20412896393866892,-0.29575813558693947,-2.7755575615628914e-16,0.093993005071267621,0.13625895639891117,0.13625895639891111,0.093993005071267788,2.7755575615628914e-16,0.29575813558693947,0.37929942281043405,0.40532549846810473,0.3792994228104335,0.2957581355869392,0.56523532699620493,0.62698457983947642,0.62698457983947686,0.56523532699620505,0.7844834736631443,0.81665368924571158,0.78448347366314419,0.9340014304080595,0.9340014304080595,1;
            expectedAB <<
                       -1,-0.9340014304080595,-0.7844834736631443,-0.56523532699620493,-0.29575813558693942,2.2204460492503131e-16,0.2957581355869392,0.56523532699620493,0.7844834736631443,0.93400143040805927,1,-1,-0.9039230039283328,-0.71618941421050597,-0.45862057964924374,-0.15774783927380909,0.15774783927380942,0.4586205796492433,0.71618941421050653,0.90392300392833169,1,-1.0000000000000004,-0.87988402041245672,-0.65073852599441051,-0.34488312271287414,2.2204460492503131e-16,0.34488312271287391,0.65073852599441051,0.87988402041245628,1,-0.99999999999999989,-0.85382070209978722,-0.57103752274935116,-0.20033546136011937,0.20033546136011937,0.57103752274935093,0.85382070209978789,0.99999999999999933,-1,-0.81706949643142879,-0.45741175337943896,2.2204460492503131e-16,0.45741175337943929,0.81706949643142868,1,-1,-0.75687614006542048,-0.28161624176456224,0.28161624176456268,0.75687614006542003,1,-1,-0.64955122615731642,4.4408920985006262e-16,0.64955122615731598,1,-1,-0.44261358688404373,0.44261358688404306,1,-0.999999999999999,4.2188474935755949e-15,1,-1,1.0000000000000067,-1,
                       -1,-1,-1,-1,-1,-1,-1,-1,-1,-0.99999999999999989,-1,-0.93400143040805939,-0.90832684462285529,-0.8960431364598922,-0.89123812190023532,-0.88986404113259854,-0.88986404113259854,-0.89123812190023521,-0.8960431364598922,-0.90832684462285618,-0.93400143040805939,-0.78448347366314441,-0.73094144337958478,-0.70266274923405247,-0.68975123147782536,-0.68613038577762142,-0.68975123147782558,-0.70266274923405236,-0.73094144337958422,-0.7844834736631443,-0.56523532699620505,-0.48806130091019845,-0.44650772492108542,-0.42874260283457399,-0.42874260283457416,-0.44650772492108576,-0.48806130091019867,-0.56523532699620505,-0.2957581355869392,-0.20412896393866919,-0.15693480711118951,-0.14251479433085162,-0.15693480711118896,-0.20412896393866892,-0.29575813558693947,-2.7755575615628914e-16,0.093993005071267621,0.13625895639891117,0.13625895639891111,0.093993005071267788,2.7755575615628914e-16,0.29575813558693947,0.37929942281043405,0.40532549846810473,0.3792994228104335,0.2957581355869392,0.56523532699620493,0.62698457983947642,0.62698457983947686,0.56523532699620505,0.7844834736631443,0.81665368924571158,0.78448347366314419,0.9340014304080595,0.9340014304080595,1;

            rs.transposeInPlace();
            expectedAB.transposeInPlace();

            ArrayXX<double> ab = rstoab(rs);

            BOOST_CHECK(ab.isApprox(expectedAB));
        }

        BOOST_AUTO_TEST_CASE(Coordinates_XYToRS)
        {
            ArrayXX<double> xy(2, 66);
            ArrayXX<double> expectedRS(2, 66);
            xy <<
                        -1,-0.9340014304080595,-0.78448347366314441,-0.56523532699620493,-0.29575813558693947,2.4833256610529142e-16,0.2957581355869392,0.56523532699620505,0.7844834736631443,0.93400143040805927,1,-0.96700071520402975,-0.86249026693428399,-0.67896301160953043,-0.43368036186031661,-0.14906098450496832,0.14906098450496846,0.43368036186031605,0.67896301160953076,0.86249026693428343,0.96700071520402964,-0.89224173683157226,-0.76151385814968486,-0.55399412385107882,-0.29138334065999855,2.0816681711721685e-16,0.29138334065999827,0.5539941238510786,0.76151385814968442,0.89224173683157215,-0.78261766349810258,-0.6352687723553343,-0.41300509393836826,-0.14311390425186113,0.14311390425186121,0.41300509393836826,0.63526877235533474,0.78261766349810236,-0.6478790677934696,-0.49192852310193314,-0.26459778933321609,7.2858385991025898e-17,0.26459778933321609,0.49192852310193319,0.64787906779346971,-0.50000000000000011,-0.34286753859696489,-0.12162175327836972,0.12162175327837008,0.34286753859696473,0.49999999999999989,-0.35212093220653023,-0.2015884104950183,9.7144514654701197e-17,0.20158841049501827,0.3521209322065304,-0.21738233650189748,-0.082550846540153947,0.08255084654015378,0.21738233650189745,-0.10775826316842774,4.7878367936959876e-16,0.1077582631684279,-0.032999284795970238,0.032999284795970397,0,
                        -0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.57735026918962584,-0.52019383130956998,-0.49795898778794051,-0.48732098446614014,-0.48315971979192329,-0.48196973094029821,-0.4819697309402981,-0.48315971979192301,-0.48732098446614019,-0.49795898778794118,-0.52019383130957009,-0.39070748244653075,-0.34433872405077243,-0.31984865653489114,-0.30866695415658463,-0.30553120979702442,-0.30866695415658485,-0.3198486565348912,-0.34433872405077204,-0.39070748244653075,-0.20083301770030484,-0.1339983505975002,-0.098011898172841228,-0.082626851144590271,-0.082626851144590382,-0.098011898172841477,-0.13399835059750043,-0.20083301770030476,0.032541075800601144,0.11189426617572781,0.15276560489851207,0.16525370228918076,0.15276560489851243,0.11189426617572801,0.03254107580060088,0.2886751345948127,0.37007546476457021,0.40667885232942613,0.40667885232942613,0.37007546476457032,0.28867513459481314,0.54480919338902489,0.61715807038942361,0.63969731306978228,0.61715807038942316,0.54480919338902467,0.77818328688993044,0.83165970851691218,0.83165970851691251,0.77818328688993066,0.96805775163615659,0.9959179755758818,0.96805775163615648,1.0975441004991959,1.0975441004991959,1.1547005383792517;
            expectedRS <<
                        -1,-0.9340014304080595,-0.7844834736631443,-0.56523532699620493,-0.29575813558693947,2.7755575615628914e-16,0.2957581355869392,0.56523532699620493,0.7844834736631443,0.93400143040805916,1,-1,-0.9083268446228564,-0.73094144337958422,-0.48806130091019889,-0.20412896393866903,0.09399300507126776,0.37929942281043361,0.62698457983947686,0.81665368924571158,0.93400143040805916,-1.0000000000000004,-0.89604313645989253,-0.7026627492340527,-0.44650772492108581,-0.1569348071111891,0.13625895639891111,0.40532549846810484,0.62698457983947642,0.7844834736631443,-0.99999999999999989,-0.89123812190023499,-0.68975123147782558,-0.4287426028345741,-0.14251479433085174,0.13625895639891111,0.37929942281043411,0.56523532699620482,-1,-0.88986404113259865,-0.68613038577762131,-0.4287426028345741,-0.1569348071111894,0.093993005071267621,0.29575813558693947,-1,-0.88986404113259876,-0.68975123147782536,-0.44650772492108554,-0.20412896393866925,-2.7755575615628914e-16,-1,-0.89123812190023532,-0.70266274923405225,-0.48806130091019839,-0.2957581355869392,-1,-0.8960431364598922,-0.73094144337958467,-0.56523532699620505,-0.99999999999999989,-0.9083268446228554,-0.78448347366314419,-1,-0.93400143040805927,-1,
                        -1,-1,-1,-1,-1,-1,-1,-1,-1,-0.99999999999999989,-1,-0.93400143040805939,-0.90832684462285529,-0.8960431364598922,-0.89123812190023532,-0.88986404113259854,-0.88986404113259854,-0.89123812190023521,-0.8960431364598922,-0.90832684462285618,-0.93400143040805939,-0.78448347366314441,-0.73094144337958478,-0.70266274923405247,-0.68975123147782536,-0.68613038577762142,-0.68975123147782558,-0.70266274923405236,-0.73094144337958422,-0.7844834736631443,-0.56523532699620505,-0.48806130091019845,-0.44650772492108542,-0.42874260283457399,-0.42874260283457416,-0.44650772492108576,-0.48806130091019867,-0.56523532699620505,-0.2957581355869392,-0.20412896393866919,-0.15693480711118951,-0.14251479433085162,-0.15693480711118896,-0.20412896393866892,-0.29575813558693947,-2.7755575615628914e-16,0.093993005071267621,0.13625895639891117,0.13625895639891111,0.093993005071267788,2.7755575615628914e-16,0.29575813558693947,0.37929942281043405,0.40532549846810473,0.3792994228104335,0.2957581355869392,0.56523532699620493,0.62698457983947642,0.62698457983947686,0.56523532699620505,0.7844834736631443,0.81665368924571158,0.78448347366314419,0.9340014304080595,0.9340014304080595,1;

            xy.transposeInPlace();
            expectedRS.transposeInPlace();

            ArrayXX<double> rs = xytors(xy);

            BOOST_CHECK(rs.isApprox(expectedRS));
        }


    BOOST_AUTO_TEST_SUITE_END()
BOOST_AUTO_TEST_SUITE_END()

